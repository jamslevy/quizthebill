(function(B){if(!B){return }B.fn.jsupload=function(C){var D=this;if(D.size()!=1){}new A(D,C)};var A=function(F,D){this.el=F;this.form=null;this.input=null;this.iframe=null;this.settings={action:"",name:"userfile",params:{},onSubmit:function(){},onComplete:function(){}};var E=B.extend(this.settings,D);var G=F.parents("form");if(G.size()&&!D.action){E.action=G.attr("action")}if(F.is("input[type='file']")){this.input=F;if(!D.name){E.name=F.attr("name")}}else{this.create_input(F)}this.create_iframe();var C=this;this.input.change(function(){C.submit()})};A.prototype={create_form:function(){this.form=B('<form method="post" enctype="multipart/form-data"></form>').appendTo("body").attr({action:this.settings.action,target:this.iframe.attr("name")});for(var C in this.settings.params){B('<input type="hidden" />').appendTo(form).attr({name:C,value:params[C]})}},create_input:function(D){D.wrap("<div></div>");var E=D.parent();E.addClass('upload_div');/*E.css({position:"relative", overflow:"hidden",  height:D.height(),width:D.width()});*/if(jQuery.browser.msie){D.add(D.parents()).each(function(){var F=B(this).css("backgroundColor");var G=B(this).css("backgroundImage");if(F!="transparent"||G!="none"){B(this).css("opacity",1);return false}})}this.input=B('<input type="file" />').attr("name",this.settings.name).css({position:"absolute",margin:0,padding:0,width:"220px",heigth:"10px",opacity:0}).appendTo(E);var C=this;E.mousemove(function(F){C.input.css({top:F.pageY-E.offset().top-5+"px",left:F.pageX-E.offset().left-170+"px"})})},create_iframe:function(){var C="iframe_"+new Date().getTime().toString().slice(7);this.iframe=B('<iframe name="'+C+'"></iframe>').appendTo("body").css("display","none")},clone_input:function(){var C=this.input,E,D;E=B('<input type="file" />').insertAfter(C);E.attr("name",this.settings.name);D=C.attr("id");C.attr("id","");E.attr("id",D);E.attr("class",C.attr("class"));E.attr("style",C.attr("style"));return E},submit:function(){var D=this,C=this.input,F=this.settings,E=this.iframe;if(F.onSubmit(C.val())===false){return }this.create_form();var G=this.clone_input();C.appendTo(this.form);this.form.submit();C.remove();this.form.remove();this.form=null;C=this.input=G;C.change(function(){D.submit()});E.load(function(){var H=E.contents().find("body").html();F.onComplete(H);setTimeout(function(){E.remove()},1)});this.create_iframe()}}})(jQuery);
